---
import ThemeToggle from './ThemeToggle.astro';

const currentPath = Astro.url.pathname;
const { user } = Astro.props;
---

<nav class="nav-bar">
  <div class="container">
    <div class="flex items-center justify-between h-16">
      <div class="flex items-center space-x-8">
        <h1 class="text-xl font-bold text-gray-900">Task Manager</h1>
        {
          user && (
            <div class="flex space-x-4">
              <a
                href="/"
                class={`nav-link ${currentPath === '/' ? 'active' : ''}`}
              >
                Todos
              </a>
              <a
                href="/projects"
                class={`nav-link ${currentPath === '/projects' ? 'active' : ''}`}
              >
                Projects
              </a>
              <a
                href="/oauth-clients"
                class={`nav-link ${currentPath === '/oauth-clients' ? 'active' : ''}`}
              >
                OAuth Clients
              </a>
              <a
                href="/trash"
                class={`nav-link ${currentPath === '/trash' ? 'active' : ''}`}
              >
                Trash
              </a>
            </div>
          )
        }
      </div>

      <div class="flex items-center space-x-4">
        {
          user && (
            <>
              <span class="text-sm text-gray-600">
                Welcome, {user.username}
              </span>
              <button id="logout-btn" class="btn btn-outline text-sm">
                Logout
              </button>
            </>
          )
        }
        <ThemeToggle />
      </div>
    </div>
  </div>
</nav>

<script>
  const logoutBtn = document.getElementById('logout-btn');
  if (logoutBtn) {
    logoutBtn.addEventListener('click', async () => {
      try {
        const response = await fetch('/api/auth/logout', {
          method: 'POST',
        });

        if (response.ok) {
          window.location.href = '/login';
        } else {
          alert('Logout failed');
        }
      } catch (error) {
        alert('Network error: ' + error.message);
      }
    });
  }
</script>
